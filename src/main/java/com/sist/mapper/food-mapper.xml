<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.food-mapper">
<select id="foodFindData" resultType="FoodVO" parameterType="hashmap"> 
 SELECT fno, name, poster, score, type, address, price, likecount, replycount, num
    FROM (
        SELECT fno, name, poster, score, type, address, price, likecount, replycount, rownum as num
        FROM (
            SELECT /*+ INDEX_ASC(food food_fno_pk) */ fno, name, poster, score, type, address, price, likecount, replycount
            FROM food
            WHERE
            <foreach collection="fdList" item="column" separator=" OR ">
                ${column} LIKE '%' || #{ss} || '%'
            </foreach>
        )
    )
    WHERE num BETWEEN #{start} AND #{end}
    </select>
  <select id="foodFindTotalPage" resultType="int" parameterType="hashmap">
    SELECT CEIL(COUNT(*) / 12.0)
    FROM food
    WHERE 
    <foreach collection="fdList" item="column" separator=" OR ">
        ${column} LIKE '%'||#{ss}||'%'
    </foreach>
  </select>
  <select id="foodFindTotalCount" resultType="int" parameterType="hashmap">
    SELECT COUNT(*) 
    FROM food
    WHERE 
    <foreach collection="fdList" item="column" separator=" OR ">
        ${column} LIKE '%' || #{ss} || '%'
    </foreach>
</select>

<!-- 상세보기 -->
  <select id="foodDetailData" resultType="FoodVO" parameterType="int">
    SELECT * FROM food
    WHERE fno=#{fno}
  </select>
  <update id="foodHitIncrement" parameterType="int">
    UPDATE food SET
    hit=hit+1
    WHERE fno=#{fno}
  </update>
  
  <!-- 홈화면 -->
  <select id="foodMainHouseData5" resultType="FoodVO">
    SELECT * FROM (SELECT * FROM food 
      ORDER BY DBMS_RANDOM.RANDOM
    )
    WHERE rownum&lt;=5
  </select>
  
  <!-- admin page -->
  <select id="adminFoodListData" resultType="FoodVO" parameterType="hashmap">
    SELECT fno,name,poster,score,type,content,theme,phone,address,hit,likecount,replycount,num
    FROM (SELECT fno,name,poster,score,type,content,theme,phone,address,hit,likecount,replycount,rownum as num 
    FROM (SELECT /*+ INDEX_ASC(food food_fno_pk)*/fno,name,poster,score,type,content,theme,phone,address,hit,likecount,replycount
    FROM food))
    WHERE num BETWEEN #{start} AND #{end}
  </select>
  <select id="adminFoodTotalPage" resultType="int" parameterType="hashmap">
    SELECT CEIL(COUNT(*)/12.0) 
    FROM food
  </select>
  <select id="adminFoodDetailData" resultType="FoodVO" parameterType="int">
   SELECT fno,name,poster,type,content,theme,phone,address,hit
   FROM food
   WHERE fno=#{fno}
 </select>
 <insert id="adminFoodInsert" parameterType="FoodVO">
   <selectKey keyProperty="fno" resultType="int" order="BEFORE">
     SELECT NVL(MAX(fno)+1,1) FROM food
   </selectKey>
   INSERT INTO food(fno,name,type,phone,address,theme,poster,time,price,content) VALUES(
     #{fno},#{name},#{type},#{phone},#{address},#{theme},#{poster},#{time},#{price},#{content, jdbcType=CLOB}
   )
 </insert>
  <update id="adminFoodUpdate" parameterType="FoodVO">
   UPDATE food SET
   name=#{name},type=#{type},address=#{address},theme=#{theme},phone=#{phone},poster=#{poster},content=#{content}
   WHERE fno=#{fno}
 </update>
 <delete id="adminFoodDelete" parameterType="int">
   DELETE FROM food
   WHERE fno=#{fno}
 </delete>
 
 <!-- reservation page -->
 <insert id="foodReserve" parameterType="FoodReserveVO">
   INSERT INTO food_reserve VALUES(
     res_id=#{res_id},res_date=#{res_date},res_time=#{res_time},people=#{people},status=#{status}
   )
 </insert>
</mapper>