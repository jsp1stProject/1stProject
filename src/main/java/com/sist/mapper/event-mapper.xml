<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.event-mapper">

	<resultMap type="EventVO" id="eventMap">
		<id column="content_id" property="content_id"/>
		<result property="cvo.title" column="title"/>
		<result property="cvo.addr1" column="addr1"/>
		<result property="cvo.addr2" column="addr2"/>
		<result property="cvo.first_image" column="first_image"/>
		<result property="cvo.first_image2" column="first_image2"/>
		<result property="cvo.tel" column="tel"/>
		<result property="cvo.cat1" column="cat1"/>
		<result property="cvo.cat2" column="cat2"/>
		<result property="cvo.cat3" column="cat3"/>
		<result property="cvo.areacode" column="areacode"/>
		<result property="dvo.info_id" column="info_id"/>
		<result property="dvo.infoname" column="infoname"/>
		<result property="dvo.infotext" column="infotext"/>
		<result property="divo.img_id" column="img_id"/>
		<result property="divo.origin_img" column="origin_img"/>
		<result property="divo.thumb_img" column="thumb_img"/>
	</resultMap>

	<select id="mainEventList" resultMap="eventMap">
		<![CDATA[
		SELECT EVENT.CONTENT_ID, title,addr1,CAT3,TO_CHAR(EVENT_STARTDATE,'YYYY.MM.DD') as dbstart,TO_CHAR(EVENT_ENDDATE,'YYYY.MM.DD') as dbend,FIRST_IMAGE,rownum
		from EVENT,CONTENT
		where event.CONTENT_ID=content.CONTENT_ID
		and EVENT_ENDDATE >= sysdate
		and CAT2='A0208'
		and rownum <6
		]]>
	</select>
	<select id="mainFesList" resultMap="eventMap">
		SELECT EVENT.CONTENT_ID,title,FIRST_IMAGE,AREACODE
		from EVENT, CONTENT
		where event.CONTENT_ID=content.CONTENT_ID
		and cat2='A0207'
		and EVENT_ENDDATE&gt;=sysdate
		and EVENT_STARTDATE&lt;=sysdate
		and rownum&lt;5
	</select>

	<!--검색 최대최소가격, 개수-->
	<select id="eventSearchPrice" resultType="EventVO" parameterType="hashmap">
		SELECT MAX(price) as maxprice, MIN(price) as minprice, count(*) as count FROM event_list_view
		<choose>
			<when test="key!=null">
				WHERE regexp_like(TITLE,#{key},'i')
			</when>
			<when test="areacode!=null">
				WHERE AREACODE in
				<foreach collection="areacode" item="c" separator="," open="(" close=")">
					#{c}
				</foreach>
			</when>
		</choose>
		<if test="filtermin != null">
			AND price between #{filtermin} and #{filtermax}
		</if>
		<if test="cate != null">
			AND CAT3 in
			<foreach collection="cate" item="c" separator="," open="(" close=")">
				#{c}
			</foreach>
		</if>
		<if test="enddate != null">
			and EVENT_ENDDATE >= sysdate
		</if>
	</select>
	<!--검색 리스트-->
	<select id="eventSearchList" resultMap="eventMap" parameterType="hashmap">
		SELECT content_id, TITLE, addr1, addr2, TO_CHAR(EVENT_ENDDATE,'YYYY.MM.DD') as dbend, CAT3, FIRST_IMAGE, price, num
		FROM (SELECT e.*,rownum as num
		FROM event_list_view e
		<choose>
			<when test="key!=null">
				WHERE regexp_like(TITLE,#{key},'i')
			</when>
			<when test="areacode!=null">
				WHERE AREACODE in
				<foreach collection="areacode" item="c" separator="," open="(" close=")">
					#{c}
				</foreach>
			</when>
		</choose>

		<if test="filtermin != null">
			AND price between #{filtermin} and #{filtermax}
		</if>
		<if test="cate != null">
			AND CAT3 in
			<foreach collection="cate" item="c" separator="," open="(" close=")">
				#{c}
			</foreach>
		</if>
		<if test="enddate != null">
			and EVENT_ENDDATE >= sysdate
		</if>
		)
		where num between #{start} and #{end}
	</select>
	<select id="eventDetailData" resultMap="eventMap" parameterType="int">
		SELECT e.content_id, TITLE, ADDR1, ADDR2, ZIPCODE, MAPX, MAPY, TEL, OVERVIEW, REVIEW_COUNT, TO_CHAR(EVENT_STARTDATE,'YYYY.MM.DD') as dbstart, TO_CHAR(EVENT_ENDDATE,'YYYY.MM.DD') as dbend, CAT3, FIRST_IMAGE, SPONSOR1, SPONSOR2, PLAYTIME, CHARGE, SPENDTIME, AGELIMIT, PRICE, PRICE_INFO
		from EVENT e join CONTENT c on e.CONTENT_ID=c.CONTENT_ID
		WHERE e.CONTENT_ID=#{contid}
	</select>
	<select id="eventDetailInfo" resultMap="eventMap" parameterType="int">
		SELECT e.CONTENT_ID, INFO_ID, INFONAME, INFOTEXT FROM EVENT e join EVENT_DETAIL d ON e.CONTENT_ID=d.CONTENT_ID
		WHERE e.CONTENT_ID=#{contid}
	</select>
	<select id="eventDetailImg" resultMap="eventMap" parameterType="int">
		SELECT e.content_id, IMG_ID, ORIGIN_IMG, THUMB_IMG FROM EVENT e join DETAIL_IMAGE d ON e.CONTENT_ID=d.CONTENT_ID
		WHERE e.CONTENT_ID=#{contid}
	</select>

	<!--	<select id="replace_data" resultMap="eventMap">-->
	<!--		SELECT CONTENT_ID,CHARGE from event-->
	<!--	</select>-->
	<!--	<insert id="replace_execute" parameterType="hashmap">-->
	<!--		UPDATE EVENT SET price=#{price}, price_info=#{info, jdbcType=VARCHAR}-->
	<!--		WHERE content_id=#{id}-->
	<!--	</insert>-->
</mapper>